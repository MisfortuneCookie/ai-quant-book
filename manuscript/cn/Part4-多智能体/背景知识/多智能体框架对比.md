# 背景知识：多智能体框架对比

> 多智能体系统正在成为复杂 AI 应用的标准架构。本文对比主流框架的特点和适用场景。

---

## 一、框架概览

| 框架 | 来源 | 定位 | 开源 |
|-----|------|-----|------|
| **Shannon** | Kocoro Labs | 生产级编排 | 是 |
| **AutoGen** | Microsoft | 对话式多智能体 | 是 |
| **CrewAI** | 社区 | 角色扮演协作 | 是 |
| **LangGraph** | LangChain | 图结构工作流 | 是 |
| **MetaGPT** | DeepWisdom | 软件开发 | 是 |

---

## 二、框架详解

### 2.1 Shannon

**定位**：生产级多智能体编排平台

**核心特点**：
- Go + Rust + Python 多语言架构
- Temporal 工作流引擎（确定性回放）
- 内置预算控制与成本追踪
- WASI 沙箱执行
- OPA 策略引擎

**架构**：
```
Orchestrator (Go)     → 任务路由、预算控制
Agent Core (Rust)     → 沙箱执行
LLM Service (Python)  → 模型调用、工具执行
Temporal              → 工作流编排
```

**适用场景**：
- 生产环境部署
- 需要成本控制
- 需要确定性调试
- 需要安全隔离

**示例**：
```bash
curl -X POST http://localhost:8080/api/v1/tasks \
  -d '{"query": "分析市场数据", "session_id": "quant-1"}'
```

---

### 2.2 AutoGen

**定位**：微软开源的对话式多智能体框架

**核心特点**：
- 基于对话的 Agent 交互
- 支持人机协作
- 代码执行能力
- 灵活的 Agent 定义

**架构**：
```
UserProxyAgent    → 代表用户，可执行代码
AssistantAgent    → LLM 驱动的助手
GroupChat         → 多 Agent 对话管理
```

**适用场景**：
- 研究和原型开发
- 代码生成任务
- 需要人机交互
- 对话式工作流

**示例**：
```python
from autogen import AssistantAgent, UserProxyAgent

assistant = AssistantAgent("assistant", llm_config=llm_config)
user_proxy = UserProxyAgent("user_proxy", code_execution_config={"work_dir": "coding"})

user_proxy.initiate_chat(assistant, message="分析这个数据集")
```

---

### 2.3 CrewAI

**定位**：角色扮演式多智能体协作框架

**核心特点**：
- 角色定义清晰（Role, Goal, Backstory）
- 任务驱动
- 工具集成
- 简单易用

**架构**：
```
Agent    → 定义角色和能力
Task     → 定义具体任务
Crew     → 组织 Agent 协作
Tool     → Agent 可用工具
```

**适用场景**：
- 快速原型
- 角色明确的任务
- 内容生成
- 研究助手

**示例**：
```python
from crewai import Agent, Task, Crew

researcher = Agent(
    role='市场研究员',
    goal='分析市场趋势',
    backstory='你是一个资深的量化分析师'
)

task = Task(
    description='分析 BTC 过去一周的走势',
    agent=researcher
)

crew = Crew(agents=[researcher], tasks=[task])
result = crew.kickoff()
```

---

### 2.4 LangGraph

**定位**：基于图结构的 Agent 工作流框架

**核心特点**：
- 状态机 + 图结构
- 循环和分支支持
- 与 LangChain 生态集成
- 可视化工作流

**架构**：
```
StateGraph   → 定义状态和转换
Node         → 处理节点（函数或 Agent）
Edge         → 状态转换逻辑
Checkpointer → 状态持久化
```

**适用场景**：
- 复杂工作流
- 需要循环逻辑
- 需要状态管理
- LangChain 用户

**示例**：
```python
from langgraph.graph import StateGraph

workflow = StateGraph(AgentState)
workflow.add_node("analyze", analyze_market)
workflow.add_node("decide", make_decision)
workflow.add_edge("analyze", "decide")

app = workflow.compile()
result = app.invoke({"input": "分析市场"})
```

---

### 2.5 MetaGPT

**定位**：软件开发多智能体系统

**核心特点**：
- 模拟软件团队
- 角色：PM、架构师、工程师、QA
- 文档驱动开发
- 代码生成

**架构**：
```
ProductManager → 需求分析
Architect      → 系统设计
Engineer       → 代码实现
QA             → 测试验证
```

**适用场景**：
- 软件开发任务
- 代码生成
- 技术文档生成

---

## 三、对比矩阵

| 特性 | Shannon | AutoGen | CrewAI | LangGraph | MetaGPT |
|-----|---------|---------|--------|-----------|---------|
| 生产就绪 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| 易用性 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| 成本控制 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐ | ⭐⭐ | ⭐⭐ |
| 调试能力 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| 安全隔离 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐ | ⭐⭐ | ⭐⭐ |
| 社区活跃 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 量化适配 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ | ⭐ |

---

## 四、量化交易场景适配

### 4.1 场景：市场分析多智能体

| 框架 | 实现难度 | 推荐度 |
|-----|---------|-------|
| Shannon | 中 | ⭐⭐⭐⭐⭐ |
| AutoGen | 低 | ⭐⭐⭐⭐ |
| CrewAI | 低 | ⭐⭐⭐ |
| LangGraph | 中 | ⭐⭐⭐⭐ |

### 4.2 场景：实时交易执行

| 框架 | 实现难度 | 推荐度 |
|-----|---------|-------|
| Shannon | 中 | ⭐⭐⭐⭐⭐ |
| AutoGen | 高 | ⭐⭐ |
| CrewAI | 高 | ⭐ |
| LangGraph | 中 | ⭐⭐⭐ |

**原因**：
- Shannon 有生产级编排和安全沙箱
- AutoGen/CrewAI 缺乏执行控制
- 实时交易需要低延迟和高可靠性

### 4.3 场景：策略研究原型

| 框架 | 实现难度 | 推荐度 |
|-----|---------|-------|
| Shannon | 中 | ⭐⭐⭐ |
| AutoGen | 低 | ⭐⭐⭐⭐⭐ |
| CrewAI | 低 | ⭐⭐⭐⭐ |
| LangGraph | 中 | ⭐⭐⭐⭐ |

**原因**：研究阶段需要快速迭代，易用性更重要

---

## 五、架构选择决策树

```
你的主要需求是什么？
│
├─ 生产环境部署
│   ├─ 需要成本控制 → Shannon
│   ├─ 需要确定性回放 → Shannon
│   └─ 需要安全沙箱 → Shannon
│
├─ 快速原型开发
│   ├─ 对话式交互 → AutoGen
│   ├─ 角色扮演任务 → CrewAI
│   └─ 复杂工作流 → LangGraph
│
├─ 代码生成任务
│   ├─ 需要人机协作 → AutoGen
│   └─ 模拟开发团队 → MetaGPT
│
└─ 量化交易
    ├─ 研究阶段 → AutoGen / CrewAI
    └─ 实盘阶段 → Shannon
```

---

## 六、集成示例

### 6.1 Shannon + 量化策略

```python
from shannon import ShannonClient

client = ShannonClient(base_url="http://localhost:8080")

# 提交分析任务
handle = client.submit_task(
    query="分析 BTC/USDT 市场状态，判断是趋势还是震荡",
    session_id="regime-detection"
)

# 等待结果
result = client.wait(handle.task_id)
```

### 6.2 AutoGen + 量化研究

```python
from autogen import AssistantAgent, UserProxyAgent

quant_analyst = AssistantAgent(
    "quant_analyst",
    system_message="你是一个量化分析师，擅长分析市场数据和设计策略",
    llm_config=llm_config
)

user = UserProxyAgent(
    "user",
    code_execution_config={"work_dir": "research"}
)

user.initiate_chat(
    quant_analyst,
    message="设计一个基于 RSI 的均值回归策略"
)
```

### 6.3 CrewAI + 研究团队

```python
from crewai import Agent, Task, Crew

analyst = Agent(
    role='量化分析师',
    goal='分析市场数据',
    tools=[market_data_tool]
)

developer = Agent(
    role='策略开发者',
    goal='将分析转化为代码',
    tools=[code_execution_tool]
)

reviewer = Agent(
    role='风控审核',
    goal='检查策略风险',
    tools=[risk_analysis_tool]
)

crew = Crew(
    agents=[analyst, developer, reviewer],
    tasks=[...],
    process="sequential"
)
```

---

## 七、未来趋势

1. **标准化**：Agent 通信协议标准化
2. **专业化**：垂直领域专用框架
3. **生产化**：更多框架支持生产部署
4. **融合**：多框架集成成为常态
5. **低代码**：可视化 Agent 编排工具

---

## 八、选择建议

| 场景 | 推荐框架 | 理由 |
|-----|---------|-----|
| 量化交易实盘 | Shannon | 生产级、成本控制、安全 |
| 量化策略研究 | AutoGen | 易用、代码执行 |
| 快速原型 | CrewAI | 最简单、角色清晰 |
| 复杂工作流 | LangGraph | 图结构、状态管理 |
| 代码生成 | AutoGen / MetaGPT | 专门优化 |

---

> **核心原则**：没有完美的框架，只有适合场景的选择。研究阶段用简单的框架快速验证，生产阶段用稳健的框架确保可靠运行。
